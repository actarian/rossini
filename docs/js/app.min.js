!function(){"use strict";angular.module("app",["ngRoute","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(e){}])}(),function(){"use strict";angular.module("app").config(["$locationProvider",function(e){e.html5Mode(!0),e.hashPrefix("")}])}(),function(){"use strict";angular.module("app").run(["$rootScope",function(e){}])}(),function(){"use strict";angular.module("app").controller("RootCtrl",["$scope",function(e){function n(e){h&&(h.volume=w.audioVolume);var n=new THREE.Color(w.colors.background).getHexString();console.log("backgroundColor",n),document.body.style.backgroundColor="#"+n,d.ribbon&&d.ribbon.updateMaterial(),angular.forEach(d.circles,function(e){e&&e.updateMaterial()})}function o(e){var n=g.getCurrentStep();n.camera.position.copy(w.camera.position),n.camera.target.copy(w.camera.target),n.circle.position.copy(w.circle.position)}function t(e,n,o){var t=2*Math.random()-1,r=Math.abs(t);return(o?Math.floor(t/r):1)*(e+(n-e)*r)}function r(){function e(){console.log("OBJECTS.ribbon.add"),y.add(m)}function n(){console.log("OBJECTS.ribbon.remove"),y.remove(m)}function o(){var e=1/g.steps.length/10,n=g.pow,o=(n+e).mod(1),t=s.getPointAt(n);t.y+=w.cameraHeight;var r=s.getPointAt(o);r.y+=w.targetHeight;var a=g.getCurrentStep();t.add(a.camera.position),r.add(a.camera.target),b.position.copy(t),b.target.copy(r),b.lookAt(b.target)}function r(){return new THREE.Vector2(window.innerWidth,window.innerHeight),new MeshLineMaterial({color:new THREE.Color(w.colors.lines),lineWidth:5,depthTest:!0})}function a(){d.ribbon.material=r(),d.ribbon.object.material=d.ribbon.material}var i=r(),c=new THREE.Vector3,l=new Array(12).fill(null).map(function(){var e=(new THREE.Vector3).copy(c);return c.x+=t(500,1e3,!0),c.y+=t(50,100,!0),c.z+=t(1e3,2e3,!1),e}),s=new THREE.CatmullRomCurve3(l);s.type="catmullrom";var u=new THREE.Geometry;u.vertices=s.getPoints(1200);var p=new MeshLine;p.setGeometry(u);var m=new THREE.Mesh(p.geometry,i);return y.add(m),b.target=b.target||new THREE.Vector3(0,0,0),{object:m,spline:s,geometry:u,material:i,add:e,remove:n,update:o,updateMaterial:a}}function a(e){function n(){console.log("OBJECTS.circles.add"),y.add(u),j.adding=Date.now(),j.removing=!1,j.enabled=!0,j.tween&&j.tween.kill(),j.tween=TweenLite.to(j,j.duration,{pow:1,delay:0,ease:Power2.easeInOut,onComplete:function(){j.adding=!1}})}function o(){console.log("OBJECTS.circles.remove"),j.adding=!1,j.removing=Date.now(),j.tween&&j.tween.kill(),j.tween=TweenLite.to(j,j.duration,{pow:0,delay:0,ease:Power2.easeInOut,onComplete:function(){j.removing=!1,j.enabled=!1,y.remove(u)}})}function t(e,n){var o=new THREE.Geometry,t=a(o,n,1),r=null;if(A){var i=new MeshLine;i.setGeometry(o),x.push(o),L.push(i),r=new THREE.Mesh(i.geometry,h)}else r=new THREE.LineLoop(o,p);return M.push(t),k.add(r),r}function r(e,n){var o=new THREE.Geometry,t=a(o,n,2),r=null;if(A){var i=new MeshLine;i.setGeometry(o),_.push(o),S.push(i),r=new THREE.Mesh(i.geometry,E)}else r=new THREE.LineLoop(o,m);return C.push(t),O.add(r),r}function a(n,o,t){return new Array(V).fill(null).map(function(r,a){var i=a/V,c=360*i;c+=60*e,c+=30*t,c+=360/V*.1*o;var l=c*Math.PI/180,s=w.radius,u=0;return u+=o*o*o*.005,r=new THREE.Vector3,r.sincos={base:s,increment:u,radius:s,x:Math.cos(l),y:Math.sin(l)},n.vertices.push(r),r})}function i(e,n,o,t){var r=w.audioStrength,a=w.noiseStrength,i=w.circularStrength,c=f;angular.forEach(n,function(e,n){var l=n%w.bands,s=(V-1-n)%w.bands,u=(c[l]+c[s])/2/w.bands,d=1===t?0:64,p=o*V+(n+d+G)%V,g=o*V+(V-1-n-d+G)%V,m=(w.noiseMap[p]+w.noiseMap[g])/2/64,f=1-(P-o)/P*i,h=e.sincos.base+e.sincos.increment*m+e.sincos.increment*u+a*m*f+r*u*f+0;e.sincos.radius=h,e.x=e.sincos.x*e.sincos.radius,e.y=e.sincos.y*e.sincos.radius,e.z=0}),e.verticesNeedUpdate=!0}function c(){angular.forEach(z,function(e,n){i(e.geometry,M[n],n,1),A&&L[n].setGeometry(x[n])}),angular.forEach(B,function(e,n){i(e.geometry,C[n],n,2),A&&S[n].setGeometry(_[n])}),k.rotation.z+=.001,O.rotation.z-=.001;var n=g.getCurrentStep(),o=d.ribbon.spline.getPointAt((e+.5)/g.steps.length);o.add(n.circle.position),u.position.copy(o),u.scale.x=u.scale.y=u.scale.z=.001+.3*j.pow,u.lookAt(b.position)}function l(){T.color.setHex(w.colors.lines),p.color.setHex(w.colors.lines),m.color.setHex(w.colors.overLines)}var s,u,p=new THREE.LineBasicMaterial({color:w.colors.lines}),m=new THREE.LineBasicMaterial({color:w.colors.overLines}),h=(new THREE.Vector2(window.innerWidth,window.innerHeight),new MeshLineMaterial({color:new THREE.Color(w.colors.lines),lineWidth:1,depthTest:!0})),E=new MeshLineMaterial({color:new THREE.Color(16777215),lineWidth:1,depthTest:!0});u=new THREE.Object3D;var v=g.steps[e],H=(new THREE.TextureLoader).load(v.circle.texture);H.wrapS=THREE.RepeatWrapping,H.wrapT=THREE.RepeatWrapping,H.repeat.set(1,1);var T=new THREE.MeshBasicMaterial({color:16777215,map:H,transparent:!0});s=new THREE.PlaneGeometry(2*w.radius-20,2*w.radius-20,8,8);var R=new THREE.Mesh(s,T);u.add(R);var M=[],C=[],L=[],S=[],x=[],_=[],A=!1,V=w.points,P=w.lines,k=new THREE.Object3D;u.add(k);var O=new THREE.Object3D;u.add(O);var z=new Array(P).fill(null).map(t),B=new Array(P).fill(null).map(r),j={pow:0,duration:.35,enabled:!1,adding:!1,removing:!1},G=0;return{add:n,remove:o,object:u,state:j,update:c,updateMaterial:l}}function i(){f&&(m.getByteFrequencyData(f),angular.forEach(d.circles,function(e){e&&e.state.enabled&&e.update()}))}function c(){E.begin(),l(),E.end(),requestAnimationFrame(c)}function l(){V&&V.update(),d.tube&&d.tube.update(),d.ribbon&&d.ribbon.update(),i(),C.render(y,b)}function s(){function e(){S=window.innerWidth,x=window.innerHeight,_=S/2,A=x/2,C.setSize(S,x),b.aspect=S/x,b.updateProjectionMatrix()}window.addEventListener("resize",e,!1)}function u(){function e(e){return e*e*e*(e*(6*e-15)+10)}function n(e,n,o){return n+e*(o-n)}function o(e,n,o,t){var r=15&e,a=r<8?n:o,i=r<4?o:12==r||14==r?n:t;return(0==(1&r)?a:-a)+(0==(2&r)?i:-i)}for(var t=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],r=0;r<256;r++)t[256+r]=t[r];return{noise:function(r,a,i){var c=Math.floor(r),l=Math.floor(a),s=Math.floor(i),u=255&c,d=255&l,p=255&s;r-=c,a-=l,i-=s;var w=r-1,g=a-1,m=i-1,f=e(r),h=e(a),E=e(i),v=t[u]+d,y=t[v]+p,b=t[v+1]+p,H=t[u+1]+d,T=t[H]+p,R=t[H+1]+p;return n(E,n(h,n(f,o(t[y],r,a,i),o(t[T],w,a,i)),n(f,o(t[b],r,g,i),o(t[R],w,g,i))),n(h,n(f,o(t[y+1],r,a,m),o(t[T+1],w,a,i-1)),n(f,o(t[b+1],r,g,m),o(t[R+1],w,g,m))))}}}var d={},p=function(){var e=document.createElement("a");return document.body.appendChild(e),e.style="display: none",function(n,o,t,r){t&&(n=r?JSON.stringify(n,null,2):JSON.stringify(n));var a=new Blob([n],{type:"octet/stream"}),i=window.URL.createObjectURL(a);e.href=i,e.download=o,e.click(),window.URL.revokeObjectURL(i)}}();Number.prototype.mod=function(e){return(this%e+e)%e};var w={colors:{background:15395048,lines:3363748,overLines:11845597,notes:3363748},cameraHeight:33,targetHeight:39,camera:{position:new THREE.Vector3,target:new THREE.Vector3},circle:{position:new THREE.Vector3},audioUrl:"audio/rossini-192.mp3",audioVolume:1,bands:128,points:128,lines:32,radius:200,audioStrength:100,noiseStrength:25,circularStrength:.9,randomize:function(){for(var e=0;e<v.__controllers.length;e++){var n=v.__controllers[e];if(n.__min){var o=n.__min+(n.__max-n.__min)*Math.random();this[n.property]=o,n.updateDisplay()}n.__color&&(n.__color.r=Math.floor(255*Math.random()),n.__color.g=Math.floor(255*Math.random()),n.__color.b=Math.floor(255*Math.random()),n.updateDisplay(),n.setValue(n.__color.hex))}},saveJson:function(){console.log("saveJson"),p(g.steps,"rossini.js",!0,!0)}};w.noiseMap=function(e,n){for(var o=e*n,t=new Uint8Array(o),r=new u,a=1,i=100*Math.random(),c=0;c<4;c++){for(var l=0;l<o;l++){var s=l%e,d=~~(l/e);t[l]+=Math.abs(r.noise(s/a,d/a,i)*a*1.75)}a*=5}return t}(w.points,w.lines);var g=function(){function e(e,n){i.tween&&(i.tween.kill(),i.tween=null),i.tween=TweenLite.to(i,i.duration,{pow:e,delay:0,ease:Power2.easeInOut,onComplete:function(){n&&n()}})}function n(n){var o=i.current||0;i.current=n;var t=c[n];w.camera.position.copy(t.camera.position),w.camera.target.copy(t.camera.target),w.circle.position.copy(t.circle.position);var r=d.circles[n]||a(n);r.add(),d.circles[n]=r,e(n/c.length,function(){i.tween=null}),setTimeout(function(){if(o!==i.current){var e=d.circles[o];e&&e.remove()}},1e3*i.duration)}function o(){l++,l=Math.min(c.length-1,l),n(l)}function t(){l--,l=Math.max(0,l),n(l)}function r(){return c[l]}var i={pow:0,duration:1.5},c=new Array(24).fill().map(function(e,n){return{camera:{position:new THREE.Vector3,target:new THREE.Vector3},circle:{position:new THREE.Vector3(60,60,0),texture:"img/rossini-01.png"}}}),l=0;return angular.extend(i,{steps:c,current:l,next:o,previous:t,getCurrentStep:r})}();e.stepper=g;var m,f,h,E,v,y,b,H,T,R,M,C,L,S,x,_,A,V=null;!function(){S=window.innerWidth,x=window.innerHeight,T=S/x,_=S/2,A=x/2,H=60,R=.001,M=2e4,y=new THREE.Scene,b=new THREE.PerspectiveCamera(H,T,R,M),b.position.z=100,b.position.y=-500,b.lookAt(new THREE.Vector3(0,0,0)),C=new THREE.WebGLRenderer({alpha:!0,antialias:!0,logarithmicDepthBuffer:!0}),C.setClearColor(0,0),C.setSize(S,x),C.shadowMap.enabled=!0,L=document.getElementById("scene"),L.appendChild(C.domElement),E=new Stats,L.appendChild(E.dom),s()}(),function(){d.ribbon=r(),d.circles=new Array(g.steps).fill(null)}(),function(){var e,n,o=window.AudioContext||window.webkitAudioContext;e=null,n=new o,m=n.createAnalyser(),h=new Audio,h.src=w.audioUrl,h.controls=!0,h.addEventListener("canplay",function(){var o;return console.log("audio canplay"),e=n.createMediaElementSource(h),e.connect(m),e.connect(n.destination),m.fftSize=2*w.bands,o=m.frequencyBinCount,console.log("bufferLength",o),f=new Uint8Array(o)}),h.volume=w.audioVolume,h.play()}(),function(){v=new dat.GUI,v.closed=!0,v.add(w,"cameraHeight",20,100).onChange(n),v.add(w,"targetHeight",20,100).onChange(n);var e=v.addFolder("circlePosition");e.add(w.circle.position,"x",-300,300).onChange(o),e.add(w.circle.position,"y",-300,300).onChange(o),e.add(w.circle.position,"z",-300,300).onChange(o);var t=v.addFolder("colors");t.addColor(w.colors,"background").onChange(n),t.addColor(w.colors,"lines").onChange(n),t.addColor(w.colors,"overLines").onChange(n),v.add(w,"audioVolume",.01,1).onChange(n),v.add(w,"audioStrength",10,100).onChange(n),v.add(w,"noiseStrength",10,100).onChange(n),v.add(w,"circularStrength",.01,.9).onChange(n),v.add(w,"randomize"),v.add(w,"saveJson")}(),n(),c()}])}();
//# sourceMappingURL=app.min.js.map
