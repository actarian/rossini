!function(){"use strict";angular.module("app",["ngRoute","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(e){}])}(),function(){"use strict";angular.module("app").config(["$locationProvider",function(e){e.html5Mode(!0),e.hashPrefix("")}])}(),function(){"use strict";angular.module("app").run(["$rootScope",function(e){}])}(),function(){"use strict";angular.module("app").controller("RootCtrl",["$scope",function(e){function n(e){g&&(g.volume=V.audioVolume);var n=new THREE.Color(V.colors.background).getHexString();console.log("backgroundColor",n),document.body.style.backgroundColor="#"+n,p.ribbon&&p.ribbon.setMaterial(),angular.forEach(p.circles,function(e){e&&e.material.color.setHex(V.colors.lines)}),p.lines&&(p.lines.material.color.setHex(V.colors.lines),"1"===V.display?p.lines.add():p.lines.remove()),p.dots&&(p.dots.material.color.setHex(V.colors.lines),"2"===V.display?p.dots.add():p.dots.remove())}function o(e,n,o){var t=V.rows,r=V.audioStrength,a=V.noiseStrength,i=Math.floor(n/t),l=n-i*t,c=2*Math.abs(l-t/2),s=1-Math.abs(i-t/2)/(t/2),u=1-Math.abs(l-t/2)/(t/2),d=(s+u)/2,f=c%V.bands,p=h[f],m=p/V.bands*s*2,w=i*t+(l+o)%t,g=V.noiseMap[w]/64*a*d+r*m;e.z+=(g-e.z)/(3+3*Math.max(1e-6,1-d))}function t(e,n,o){var t=2*Math.random()-1,r=Math.abs(t);return(o?Math.floor(t/r):1)*(e+(n-e)*r)}function r(){function e(){console.log("OBJECTS.ribbon.add"),b.add(h)}function n(){console.log("OBJECTS.ribbon.remove"),b.remove(h)}function o(){var e=1/m.steps.length/10,n=m.pow,o=(n+e).mod(1),t=u.getPointAt(n),r=d.getPointAt(o);y.position.copy(t),y.target.copy(r),y.lookAt(y.target)}function r(){var e=new THREE.Vector2(window.innerWidth,window.innerHeight);return new MeshLineMaterial({color:new THREE.Color(V.colors.lines),lineWidth:4,opacity:1,resolution:e,sizeAttenuation:1,near:1,far:1e3,depthTest:!1,blending:THREE.AdditiveBlending,transparent:!1,side:THREE.DoubleSide})}function a(){p.ribbon.material=r(),p.ribbon.object.material=p.ribbon.material}var i=r(),l=new THREE.Vector3,c=new Array(12).fill(null).map(function(){var e=(new THREE.Vector3).copy(l);return l.x+=t(500,1e3,!0),l.y+=t(50,100,!0),l.z+=t(1e3,2e3,!1),e}),s=new THREE.CatmullRomCurve3(c);s.type="catmullrom";var u=new THREE.CatmullRomCurve3(s.points.map(function(e){return new THREE.Vector3(e.x,e.y+30,e.z)}));u.type="catmullrom";var d=new THREE.CatmullRomCurve3(s.points.map(function(e){return new THREE.Vector3(e.x,e.y+15,e.z)}));d.type="catmullrom";var f=new THREE.Geometry;f.vertices=s.getPoints(1200);var w=new MeshLine;w.setGeometry(f);var h=new THREE.Mesh(w.geometry,i);return b.add(h),y.target=y.target||new THREE.Vector3(0,0,0),{object:h,spline:s,cameraSpline:u,targetSpline:d,geometry:f,material:i,add:e,remove:n,update:o,setMaterial:a}}function a(e){function n(){console.log("OBJECTS.circles.add"),b.add(i),f.adding=Date.now(),f.removing=!1,f.enabled=!0,f.tween&&f.tween.kill(),f.tween=TweenLite.to(f,f.duration,{pow:1,delay:0,ease:Power2.easeInOut,onComplete:function(){f.adding=!1}})}function o(){console.log("OBJECTS.circles.remove"),f.adding=!1,f.removing=Date.now(),f.tween&&f.tween.kill(),f.tween=TweenLite.to(f,f.duration,{pow:0,delay:0,ease:Power2.easeInOut,onComplete:function(){f.removing=!1,f.enabled=!1,b.remove(i)}})}function t(){var e=V.rows,n=V.audioStrength,o=V.noiseStrength,t=V.circularStrength;angular.forEach(d,function(r,a){var i=Math.floor(a/e),l=a-i*e,c=(Math.abs(l-e/2),Math.abs(i-e/2),Math.abs(l-e/2),i%V.bands),s=(h[c]+h[e-1-c])/2,u=s/V.bands,d=l*e+(i+w)%e,f=V.noiseMap[d],p=1-(e-l)/e*t,m=r.r.z+f/64*o*p+2*n*u*u*p,g=r.radius||m;g+=(m-g)/2,r.x=r.r.x*g,r.y=r.r.y*g,r.z=0,r.radius=g}),angular.forEach(l,function(e,n){e.geometry.verticesNeedUpdate=!0}),i.scale.x=i.scale.y=i.scale.z=.001+.3*f.pow,i.lookAt(y.position)}var r,a,i,l=[];i=new THREE.Object3D,r=new THREE.IcosahedronGeometry(90,3),a=new THREE.MeshBasicMaterial({color:16776960});var c=new THREE.Mesh(r,a);i.add(c),a=new THREE.LineBasicMaterial({color:V.colors.lines});var s=V.rows;for(V.space;l.length<V.rows;){r=new THREE.Geometry;var u=new THREE.LineLoop(r,a);u.points=new Array(s).fill(null),l.push(u),i.add(u)}var d=new Array(s*s).fill(null).map(function(e,n){var o=Math.floor(n/s),t=n-o*s,r=2*Math.PI/s,a=r*o+r*t*.1,i=new THREE.Vector3;return i.r={x:Math.cos(a),y:Math.sin(a),z:96+t*t*t*1e-4},l[t].points[o]=i,l[t].geometry.vertices.push(i),i}),f={pow:0,duration:.35,enabled:!1,adding:!1,removing:!1},w=0,g=p.ribbon.cameraSpline.getPointAt((e+.5)/m.steps.length);return i.position.copy(g),{add:n,remove:o,update:t,object:i,material:a,state:f}}function i(){function e(){console.log("OBJECTS.dots.add"),b.add(i)}function n(){console.log("OBJECTS.dots.remove"),b.remove(i)}function t(){angular.forEach(a.vertices,function(e,n){o(e,n,m)}),m++,a.verticesNeedUpdate=!0}for(var r=new THREE.PointsMaterial({color:V.colors.lines,size:1,sizeAttenuation:!1}),a=new THREE.Geometry,i=new THREE.Points(a,r),l=V.rows,c=V.space,s=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),t=n-o*l;return Math.abs(o-l/2),Math.abs(t-l/2),{x:-c*l/2+c*t,y:-c*l/2+c*o,z:0}}),u=0,d=s.length;u<d;){var f=s[u],p=new THREE.Vector3;p.x=f.x,p.y=f.y,p.z=f.z,a.vertices.push(p),u++}a.verticesNeedUpdate=!0,i.geometry=a;var m=0;return{object:i,material:r,add:e,remove:n,update:t}}function l(){function e(){console.log("OBJECTS.lines.add"),b.add(r)}function n(){console.log("OBJECTS.lines.remove"),b.remove(r)}function t(){V.rows,V.audioStrength,V.noiseStrength,angular.forEach(d,function(e,n){o(e,n,f)}),angular.forEach(i,function(e,n){e.geometry.verticesNeedUpdate=!0}),f++}var r,a,i=[];a=new THREE.LineBasicMaterial({color:V.colors.lines}),r=new THREE.Object3D;for(var l=V.rows,c=V.space;i.length<V.rows;){var s=new THREE.Geometry,u=new THREE.Line(s,a);u.points=new Array(l).fill(null),i.push(u),r.add(u)}var d=new Array(l*l).fill(null).map(function(e,n){var o=Math.floor(n/l),t=n-o*l,r=(Math.abs(o-l/2),Math.abs(t-l/2),new THREE.Vector3(-c*l/2+c*t,-c*l/2+c*o,0));return i[t].points[o]=r,i[t].geometry.vertices.push(r),r}),f=0;return{add:e,remove:n,update:t,object:r,material:a}}function c(){h&&(w.getByteFrequencyData(h),"0"===V.display?angular.forEach(p.circles,function(e){e&&e.state.enabled&&e.update()}):"1"===V.display?p.lines.update():"2"===V.display&&p.dots.update())}function s(){E.begin(),u(),E.end(),requestAnimationFrame(s)}function u(){B&&B.update(),p.tube&&p.tube.update(),p.ribbon&&p.ribbon.update(),c(),C.render(b,y)}function d(){function e(){A=window.innerWidth,x=window.innerHeight,z=A/2,_=x/2,C.setSize(A,x),y.aspect=A/x,y.updateProjectionMatrix()}window.addEventListener("resize",e,!1)}function f(){function e(e){return e*e*e*(e*(6*e-15)+10)}function n(e,n,o){return n+e*(o-n)}function o(e,n,o,t){var r=15&e,a=r<8?n:o,i=r<4?o:12==r||14==r?n:t;return(0==(1&r)?a:-a)+(0==(2&r)?i:-i)}for(var t=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],r=0;r<256;r++)t[256+r]=t[r];return{noise:function(r,a,i){var l=Math.floor(r),c=Math.floor(a),s=Math.floor(i),u=255&l,d=255&c,f=255&s;r-=l,a-=c,i-=s;var p=r-1,m=a-1,w=i-1,h=e(r),g=e(a),E=e(i),v=t[u]+d,b=t[v]+f,y=t[v+1]+f,M=t[u+1]+d,T=t[M]+f,H=t[M+1]+f;return n(E,n(g,n(h,o(t[b],r,a,i),o(t[T],p,a,i)),n(h,o(t[y],r,m,i),o(t[H],p,m,i))),n(g,n(h,o(t[b+1],r,a,w),o(t[T+1],p,a,i-1)),n(h,o(t[y+1],r,m,w),o(t[H+1],p,m,w))))}}}var p={};Number.prototype.mod=function(e){return(this%e+e)%e};var m=function(){function e(e,n){r.tween&&(r.tween.kill(),r.tween=null),r.tween=TweenLite.to(r,r.duration,{pow:e,delay:0,ease:Power2.easeInOut,onComplete:function(){n&&n()}})}function n(n){var o=r.current||0;r.current=n;var t=p.circles[n]||a(n);t.add(),p.circles[n]=t,e(n/i.length,function(){r.tween=null}),setTimeout(function(){if(o!==r.current){var e=p.circles[o];e&&e.remove()}},1e3*r.duration)}function o(){l++,l=Math.min(i.length-1,l),n(l)}function t(){l--,l=Math.max(0,l),n(l)}var r={pow:0,duration:1.5},i=new Array(24).fill().map(function(e,n){return n+1}),l=0;return angular.extend(r,{steps:i,current:l,next:o,previous:t})}();e.stepper=m;var w,h,g,E,v,b,y,M,T,H,R,C,S,A,x,z,_,B=null,V={audioUrl:"audio/rossini-192.mp3",audioVolume:.5,colors:{background:1118481,lines:10066329,notes:4473924},bands:256,rows:128,space:10,audioStrength:60,noiseStrength:25,circularStrength:.9,display:"0",randomize:function(){for(var e=0;e<v.__controllers.length;e++){var n=v.__controllers[e];if(n.__min){var o=n.__min+(n.__max-n.__min)*Math.random();this[n.property]=o,n.updateDisplay()}n.__color&&(n.__color.r=Math.floor(255*Math.random()),n.__color.g=Math.floor(255*Math.random()),n.__color.b=Math.floor(255*Math.random()),n.updateDisplay(),n.setValue(n.__color.hex))}}};V.points=new Array(2*V.bands).fill(null).map(function(){var e=1e3;return new THREE.Vector3(-e+2e3*Math.random(),-e+2e3*Math.random(),-e+2e3*Math.random())}),V.noiseMap=function(e,n){for(var o=e*n,t=new Uint8Array(o),r=new f,a=1,i=100*Math.random(),l=0;l<4;l++){for(var c=0;c<o;c++){var s=c%e,u=~~(c/e);t[c]+=Math.abs(r.noise(s/a,u/a,i)*a*1.75)}a*=5}return t}(V.rows,V.rows),function(){A=window.innerWidth,x=window.innerHeight,T=A/x,z=A/2,_=x/2,M=60,H=.001,R=2e4,b=new THREE.Scene,y=new THREE.PerspectiveCamera(M,T,H,R),y.position.z=100,y.position.y=-500,y.lookAt(new THREE.Vector3(0,0,0)),C=new THREE.WebGLRenderer({alpha:!0,antialias:!0,logarithmicDepthBuffer:!0}),C.setClearColor(0,0),C.setSize(A,x),C.shadowMap.enabled=!0,S=document.getElementById("scene"),S.appendChild(C.domElement),E=new Stats,S.appendChild(E.dom),d()}(),function(){p.ribbon=r(),p.dots=i(),p.lines=l(),p.circles=new Array(m.steps).fill(null)}(),function(){var e,n,o=window.AudioContext||window.webkitAudioContext;e=null,n=new o,w=n.createAnalyser(),g=new Audio,g.src=V.audioUrl,g.controls=!0,g.addEventListener("canplay",function(){var o;return console.log("audio canplay"),e=n.createMediaElementSource(g),e.connect(w),e.connect(n.destination),w.fftSize=2*V.bands,o=w.frequencyBinCount,console.log("bufferLength",o),h=new Uint8Array(o)}),g.volume=V.audioVolume,g.play()}(),function(){v=new dat.GUI,v.closed=!0,v.add(V,"display",{Circles:0,Lines:1,Dots:2}).onChange(n),v.addColor(V.colors,"background").onChange(n),v.addColor(V.colors,"lines").onChange(n),v.add(V,"audioVolume",.01,1).onChange(n),v.add(V,"audioStrength",10,100).onChange(n),v.add(V,"noiseStrength",10,100).onChange(n),v.add(V,"circularStrength",.01,.9).onChange(n),v.add(V,"randomize")}(),n(),s()}])}();
//# sourceMappingURL=app.min.js.map
